非连续内存分配

1.为什么要使用非连续内存分配

2.分段，分页的区别。



分页

- 页表，页表项，页的寻址机制

- MMU/TLB，多级页表，反向页表。

物理地址空间的分配单位是帧，大小固定，逻辑地址空间的分配单位是页，也是大小固定。帧和页大小相同，通过页表保存映射关系。物理地址空间与逻辑地址空间的偏移地址相同。

逻辑地址范围一般大于物理地址。所以并不是所有页都在内存中。页是连续的虚拟内存，帧是非连续的物理内存。

分页一般使用CPU里的MMU实现。每个进程有自己的页表（完整大小，并不是用多少存多少，因为你并不能预知进程逻辑地址的范围）。



如果用软件实现，代价太大。因为如果使用软件实现，页表保存在内存中。访问一个内存单元需要两次内存访问。

- 一次用于读取页表，一次用于获取数据

页表数量很多，用内存存储页表要消耗大量内存。



大部分计算机问题的解决思路是：

- 缓存（cache）
- 间接访问（indirection）**索引之类的东西**

1. 用CPU中的 TLB 缓存页表，虽然缓存页表项不多,但是页的大小比较大，要访问的数据不在该页内，才会产生缺失。只要程序按照局部性原理就不会造成TLB的页缺失。对于TLB的缓存谁来写，可以硬件实现，也可以CPU来写。
2. 多级页表。实际上一级页表和多级页表总的页表项中，是多级页表的页表项更多（如果所有页都驻留内存的话）。但是为什么多级页表项能更节省内存呢？主要是因为，如果上一级页表项不驻留内存，则这一级以下的所有页表项都可以不用保存了。通过分级，大量的节省了没用到的页表项。毕竟程序一般不会用到很大的内存。
3. 反向页表。